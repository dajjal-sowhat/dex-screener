var St=Object.defineProperty;var ht=(r,t,e)=>t in r?St(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var V=(r,t,e)=>ht(r,typeof t!="symbol"?t+"":t,e);import{gj as gt,ae as ze,af as Xe,gk as Je,gl as ge,ah as bt,gm as yt,gn as ft,go as vt,gp as Pt,gq as wt,gr as $,gs as Ct,ge as pe,G as U,g6 as kt,j as u,bz as a,gt as Tt,gu as xt,gv as At,y as x,cC as I,gw as Lt,aY as ie,cS as Bt,a_ as oe,cV as Ut,cW as Ne,gx as Ye,gy as It,a9 as ae,gz as Et,gA as Rt,bb as Dt,bc as Q,bd as Nt,be as Vt,bg as _t,k as A,bi as Ke,K as Mt,gB as L,gC as h,gD as c,gE as F,dq as le,bE as Ze,g1 as Qe,cr as Ht,gF as $t,gG as O,gH as et,gI as Ot,gJ as Wt,gK as Ft,gL as jt,d4 as tt,cT as rt,a7 as R,cR as Gt,gM as st,a8 as qt,er as be,eZ as nt,gN as zt,aV as Xt,cY as Jt,gO as Z,bn as Yt,s as Kt,a5 as Zt,eR as Qt,aW as er,dS as tr,cn as rr,p as Ve,E as sr,c1 as nr,B as or,gP as ir}from"../entries/pages_catch-all.DeNA4nR9.js";import{g as ar,c as lr}from"./ErrorMessageServerConnection-O3DygrcT.js";import{d as cr}from"./dex-search.service-DBnH3Ikf.js";import{c as ur}from"./catchError-CZLiBm8_.js";var dr=gt(function(r){return function(e){e===void 0&&(e=null),r(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function mr(r,t){var e=yt(r)?{first:r}:typeof r=="number"?{each:r}:r,s=e.first,i=e.each,n=e.with,o=n===void 0?pr:n,l=e.scheduler,m=l===void 0?Je:l,d=e.meta,S=d===void 0?null:d;if(s==null&&i==null)throw new TypeError("No timeout provided.");return ze(function(p,f){var P,b,g=null,v=0,k=function(_){b=ge(f,m,function(){try{P.unsubscribe(),bt(o({meta:S,lastValue:g,seen:v})).subscribe(f)}catch(D){f.error(D)}},_)};P=p.subscribe(Xe(f,function(_){b==null||b.unsubscribe(),v++,f.next(g=_),i>0&&k(i)},void 0,void 0,function(){b!=null&&b.closed||b==null||b.unsubscribe(),g=null})),!v&&k(s!=null?typeof s=="number"?s:+s-m.now():i)})}function pr(r){throw new dr(r)}function Sr(r){for(var t,e,s=[],i=1;i<arguments.length;i++)s[i-1]=arguments[i];var n=(t=ft(s))!==null&&t!==void 0?t:Je,o=(e=s[0])!==null&&e!==void 0?e:null,l=s[1]||1/0;return ze(function(m,d){var S=[],p=!1,f=function(g){var v=g.buffer,k=g.subs;k.unsubscribe(),Pt(S,g),d.next(v),p&&P()},P=function(){if(S){var g=new wt;d.add(g);var v=[],k={buffer:v,subs:g};S.push(k),ge(g,n,function(){return f(k)},r)}};o!==null&&o>=0?ge(d,n,P,o,!0):p=!0,P();var b=Xe(d,function(g){var v,k,_=S.slice();try{for(var D=vt(_),E=D.next();!E.done;E=D.next()){var X=E.value,w=X.buffer;w.push(g),l<=w.length&&f(X)}}catch(M){v={error:M}}finally{try{E&&!E.done&&(k=D.return)&&k.call(D)}finally{if(v)throw v.error}}},function(){for(;S!=null&&S.length;)d.next(S.shift().buffer);b==null||b.unsubscribe(),d.complete(),d.unsubscribe()},void 0,function(){return S=null});m.subscribe(b)})}const ot=()=>Intl.DateTimeFormat().resolvedOptions().timeZone,hr=r=>{let t=["iframe_loading_compatibility_mode","study_templates","items_favoriting","datasource_copypaste","seconds_resolution"],e=["auto_enable_symbol_labels","header_symbol_search","save_shortcut","header_saveload","header_fullscreen_button","symbol_search_hot_key","popup_hints","legend_inplace_edit"];const i={library_path:"/tv/v27.001/",logo:r.hideTradingViewLogo?{image:"/transparent-pixel.png"}:void 0,theme:"dark",locale:"en",autosize:!0,symbol_search_request_delay:500,container:r.containerId,auto_save_delay:2,timezone:ot(),interval:r.defaultInterval??$[15],favorites:{intervals:r.favoriteIntervals,chartTypes:["Line","Candles"]},overrides:{...r.widgetOverrides,"scalesProperties.fontSize":14,"scalesProperties.showStudyLastValue":!1,"scalesProperties.showSymbolLabels":!1,"mainSeriesProperties.style":r.chartStyle??1},datafeed:r.dataFeed.getDataFeed(),symbol:r.symbol,saved_data:r.savedData,save_load_adapter:r.saveLoadAdapter,custom_formatters:{priceFormatterFactory:()=>({format:n=>n===null?n:Ct({price:n})})}};return r.settingsAdapter&&(i.settings_adapter=r.settingsAdapter),r.symbolLogo&&t.push("show_symbol_logos"),r.enabledFeatures&&(t.push(...r.enabledFeatures),e=e.filter(n=>{var o;return!((o=r.enabledFeatures)!=null&&o.includes(n))})),r.disabledFeatures&&(e.push(...r.disabledFeatures),t=t.filter(n=>{var o;return!((o=r.disabledFeatures)!=null&&o.includes(n))})),i.enabled_features=t,i.disabled_features=e,i},z=(r,t,e)=>{const s=new Date(r);switch(t){case"second":s.setMilliseconds(0),s.setSeconds(s.getSeconds()-s.getSeconds()%e);break;case"minute":s.setSeconds(0,0),s.setMinutes(s.getMinutes()-s.getMinutes()%e);break;case"hour":s.setMinutes(0,0,0),s.setHours(s.getHours()-s.getHours()%e);break;case"day":s.setHours(0,0,0,0),s.setDate(s.getDate()-s.getDate()%e);break;case"week":{const i=s.getDay(),n=(i===0?7:i)-1;s.setDate(s.getDate()-n),s.setHours(0,0,0,0);break}case"month":if(e!==1)throw new Error("Month truncation only supports amount of 1");s.setHours(0,0,0,0),s.setDate(1);break;default:throw new Error("Unsupported interval")}return Math.floor(s.getTime()/1e3)},gr=(r,t)=>{if(t.endsWith("S")){const e=pe(t.split("S")[0]??t);return z(r,"second",e)}else if(t.endsWith("M")){const e=pe(t.split("M")[0]??t);return z(r,"month",e)}else if(t.endsWith("W")){const e=pe(t.split("W")[0]??t);return z(r,"week",e)}else{const e=Number.parseInt(t);if(e<60)return z(r,"minute",e);if(e>=60&&e<=720){const s=Math.floor(e/60);return z(r,"hour",s)}else return z(r,"day",1)}},br=()=>({buildSearchTicker:(r,t)=>{var s;let e=`${t.chainId}+${t.pairAddress}+${(s=t.quoteToken)==null?void 0:s.address}`;return t.c&&(e=`${e}+${t.c}`,t.c==="a"&&(e=`${e}+${t.a}`)),`${r} (${e})`},getComparableSymbolDetail:r=>{const t=/\((.*\+.*)\)/,e=r.match(t);if(!e||!e[1])return;const[s,i,n,o,l]=e[1].split("+");if(!(!s||!i||!n))return{context:o==null?void 0:o.toLowerCase(),ammId:l==null?void 0:l.toLowerCase(),chainId:s.toLowerCase(),pairId:i.toLowerCase(),quoteTokenAddress:n.toLowerCase()}}});class yr{constructor(t){V(this,"params");V(this,"barCursor",{});V(this,"isTriggeringSubscribers",!1);V(this,"symbolManagement",br());V(this,"subscribeBarsCallbacks",[]);V(this,"makerHistory",[]);V(this,"getResolution",t=>t.indexOf("S")!=-1?t:t==="1D"?1440:t);V(this,"getSymbolInfoDescription",t=>this.params.chartType==="marketCap"?`${t} (Market Cap) on ${this.params.dexName}`:`${t} on ${this.params.dexName}`);this.params=t,this.makerHistory=[]}async fetchDexChartBars(t){var i;const e=await this.params.dexChartAmmService.getBars({chartType:this.params.chartType,context:t.context,ammId:t.ammId,chainId:t.chainId,pairAddress:t.pairAddress,quoteTokenAddress:t.quoteTokenAddress,beforeBlockNumber:t.beforeBlockNumber,afterBlockNumber:t.afterBlockNumber,resolution:this.getResolution(t.resolution).toString(),countBack:t.countBack,usdOnly:t.usdOnly,isInverted:t.isInverted,circulatingSupply:this.params.circulatingSupply??void 0}),s=[];return(i=e.bars)==null||i.forEach(n=>{if(n.closeUsd&&t.usdOnly){const o=new U(n.closeUsd).toNumber();s.push({time:n.timestamp,open:n.openUsd?new U(n.openUsd).toNumber():o,high:n.highUsd?new U(n.highUsd).toNumber():o,low:n.lowUsd?new U(n.lowUsd).toNumber():o,close:n.closeUsd?new U(n.closeUsd).toNumber():o,volume:n.volumeUsd?new U(n.volumeUsd).toNumber():void 0,minBlockNumber:n.minBlockNumber,maxBlockNumber:n.maxBlockNumber})}else t.usdOnly||s.push({time:n.timestamp,open:new U(n.open).toNumber(),high:new U(n.high).toNumber(),low:new U(n.low).toNumber(),close:new U(n.close).toNumber(),volume:n.volumeUsd?new U(n.volumeUsd).toNumber():void 0,minBlockNumber:n.minBlockNumber,maxBlockNumber:n.maxBlockNumber})}),s}getFetchBarParameters(t){const e=this.symbolManagement.getComparableSymbolDetail(t);return e||{context:this.params.context,ammId:this.params.ammId,chainId:this.params.chainId,pairId:this.params.pairAddress,quoteTokenAddress:this.params.quoteTokenAddress}}setBarCursor(t){var i,n;const e=t.oldest?{...t.oldest}:(i=this.barCursor[t.resolution])==null?void 0:i.oldest,s=t.newest?{...t.newest}:(n=this.barCursor[t.resolution])==null?void 0:n.newest;this.barCursor[t.resolution]={oldest:e,newest:s}}setTradingHistoryMarks(t){this.makerHistory=t}getDataFeed(){return{onReady:t=>{setTimeout(()=>{t({supported_resolutions:this.params.supportedResolutions,supports_marks:!0})},0)},searchSymbols:async(t,e,s,i)=>{const o=(await this.params.searchPair(t)).map(l=>{const m=`${l.baseToken.symbol}/${l.quoteTokenSymbol}`,d=this.symbolManagement.buildSearchTicker(m,l);return{symbol:m,full_name:m,description:`${l.chainId} / ${l.dexId}`,exchange:"dexscreener.com",ticker:d,type:""}});i(o)},resolveSymbol:(t,e)=>{setTimeout(()=>{var n;let s=100,i=((n=this.params.latestPrice.split(".")[1])==null?void 0:n.length)??0;i<4&&(i=4),i>2&&(s=10**Math.min(i,16)),e({name:t,description:this.getSymbolInfoDescription(t),exchange:"dexscreener.com",minmov:1,pricescale:s,session:"24x7",timezone:ot(),supported_resolutions:this.params.supportedResolutions,has_seconds:!0,has_intraday:!0,has_daily:!0,visible_plots_set:"ohlcv",logo_urls:[this.params.symbolLogo]})},0)},getBars:async(t,e,s,i,n)=>{var f,P;const{context:o,ammId:l,chainId:m,pairId:d,quoteTokenAddress:S}=this.getFetchBarParameters(t.name),p=await kt({callback:()=>{var b,g;return this.fetchDexChartBars({context:o,ammId:l,chainId:m,pairAddress:d,quoteTokenAddress:S,beforeBlockNumber:(g=(b=this.barCursor[e])==null?void 0:b.oldest)==null?void 0:g.minBlockNumber,resolution:e,countBack:s.countBack,usdOnly:this.params.useUsdPrice,isInverted:this.params.isInverted})},retrySettings:{tries:3,delayInMs:1e3,timeoutInMs:3e4}}).catch(()=>{n("Failed fetching bars")});if(p)if(p.length>0){const b=(f=this.barCursor[e])==null?void 0:f.newest,g=p[p.length-1];g&&(!b||b.maxBlockNumber<g.maxBlockNumber)&&(this.setBarCursor({resolution:e,newest:g}),this.params.onLatestPrice&&this.params.onLatestPrice({value:g.close,usd:this.params.useUsdPrice}));const v=(P=this.barCursor[e])==null?void 0:P.oldest,k=p[0];k&&(!v||v.minBlockNumber>k.minBlockNumber)&&this.setBarCursor({resolution:e,oldest:k}),i(p)}else i([],{noData:!0})},getMarks:(t,e,s,i,n)=>{const o=this.makerHistory.map(l=>({id:l.id,time:gr(l.timestamp,n),color:{border:l.color,background:l.color},text:l.text,label:l.label,labelFontColor:"white",minSize:25}));i(o)},subscribeBars:(t,e,s,i)=>{this.subscribeBarsCallbacks.push({subscriberId:i,symbolName:t.name,resolution:e,callback:s})},unsubscribeBars:t=>{this.subscribeBarsCallbacks.forEach(e=>{e.subscriberId===t&&(e.callback=null,delete this.barCursor[e.resolution])})}}}triggerSubscribers(){Object.keys(this.barCursor).length!==0&&(this.isTriggeringSubscribers||(this.isTriggeringSubscribers=!0,Promise.all(this.subscribeBarsCallbacks.map(async({symbolName:t,resolution:e,callback:s})=>{var p;if(!s)return;const i=(p=this.barCursor[e])==null?void 0:p.newest;if(!i)return;const{context:n,ammId:o,chainId:l,pairId:m,quoteTokenAddress:d}=this.getFetchBarParameters(t),S=await this.fetchDexChartBars({context:n,ammId:o,chainId:l,pairAddress:m,quoteTokenAddress:d,afterBlockNumber:i.minBlockNumber-1,resolution:e,countBack:2,usdOnly:this.params.useUsdPrice,isInverted:this.params.isInverted}).catch(()=>{});if(S&&S.length!==0)try{S.forEach(f=>{var b;const P=(b=this.barCursor[e])==null?void 0:b.newest;if(P){if(f.minBlockNumber===P.minBlockNumber){const g={...f,open:P.open};this.setBarCursor({resolution:e,newest:g}),s(g)}else if(f.minBlockNumber>P.minBlockNumber){const g={...f,open:P.close};this.setBarCursor({resolution:e,newest:g}),s(g)}}}),this.params.onLatestPrice&&this.params.onLatestPrice({value:i.close,usd:this.params.useUsdPrice})}catch{}})).then(()=>{this.isTriggeringSubscribers=!1})))}}const fr=a.enum(["idle","loading","ready","error"]),vr=r=>{const[t,e]=u.useState(r?"loading":"idle");return u.useEffect(()=>{if(!r){e("idle");return}let s=document.querySelector(`script[src='${r}']`);if(s){const n=fr.safeParse(s.getAttribute("data-status"));n.success&&e(n.data)}else{s=document.createElement("script"),s.src=r,s.async=!0,s.setAttribute("data-status","loading"),document.body.appendChild(s);const n=o=>{s==null||s.setAttribute("data-status",o.type==="load"?"ready":"error")};s.addEventListener("load",n),s.addEventListener("error",n)}const i=n=>{e(n.type==="load"?"ready":"error")};return s.addEventListener("load",i),s.addEventListener("error",i),()=>{s&&(s.removeEventListener("load",i),s.removeEventListener("error",i))}},[r]),t},Se=a.object({pairChartSettings:Tt.optional(),globalChartSettings:xt.optional(),chartStudyTemplates:a.array(At).optional()}),_e="chart.lastUsedTimeBasedResolution",Me="chartproperties.mainSeriesProperties",Pr=x(ie,Lt,(r,t)=>({actions:{async allChartStudyTemplates(){const e=await I(r.currentUser);return e?t.findByUserId(e.id):[]},async persistChartStudyTemplate(e){const s=await I(r.ensuredCurrentUser),n=(await t.findByUserId(s.id)).find(o=>o.name===e.name);n?await t.update({id:n.id,userId:s.id,input:e}):await t.create(s.id,e)},async deleteChartStudyTemplate(e){await t.delete(e)}}})),wr=x(ie,Et,ae,(r,t,e)=>{const s=r.currentUser.pipe(Bt(o=>o?new Ut(l=>t.findByUserIdSnapshot({userId:o.id,onResult:m=>{l.next(m)},onError:m=>{e.error({event:{id:"failedOnReadingGlobalChartSettingsStore",data:{error:m,userId:o.id}}}),l.error(m)}})):oe(void 0)),Ne),i=new Ye,n=It(s,i).pipe(Ne);return{all:n,actions:{async createGlobalChartSettings(o){const l=await I(r.ensuredCurrentUser);await t.create(l.id,o)},async updateGlobalChartSettings(o,l){const m=await I(r.ensuredCurrentUser);await t.update({id:o,userId:m.id,input:l})},async persistGlobalChartSettings(o){const l=await I(n),m=await I(r.ensuredCurrentUser);if(l){const d={...l,settings:{...l.settings,...o.settings}};i.next(d),await this.updateGlobalChartSettings(l.id,d).catch(S=>{e.error({event:{id:"failedUpdatingGlobalChartSettings",data:{error:S,userId:m.id}}})})}else await this.createGlobalChartSettings(o)}}}}),Cr=x(ie,Rt,(r,t)=>{const e=async i=>{const n=await I(r.ensuredCurrentUser);await t.create(n.id,i)},s=async(i,n)=>{const o=await I(r.ensuredCurrentUser);await t.update({pairChartSettings:i,input:n,userId:o.id})};return{actions:{async getPairChartSettings(i){const n=await I(r.currentUser);if(!n)return;const o=await t.findByPairId({userId:n.id,pairId:i.pair.pairId,chainId:i.pair.chainId});if(o)return o},async persistPairChartSettings(i){const n=await I(r.ensuredCurrentUser),o=await t.findByPairId({userId:n.id,pairId:i.pair.pairId,chainId:i.pair.chainId});o?await s(o,i):await e(i)}}}}),kr=["volumePaneSize","editorFontsList","priceScaleSelectionStrategyName","paneProperties.backgroundType","paneProperties.background","paneProperties.backgroundGradientStartColor","paneProperties.backgroundGradientEndColor","paneProperties.vertGridProperties.color","paneProperties.vertGridProperties.style","paneProperties.horzGridProperties.color","paneProperties.horzGridProperties.style","paneProperties.crossHairProperties.color","paneProperties.crossHairProperties.style","paneProperties.crossHairProperties.transparency","paneProperties.crossHairProperties.width","paneProperties.topMargin","paneProperties.bottomMargin","paneProperties.axisProperties.autoScale","paneProperties.axisProperties.percentage","paneProperties.axisProperties.indexedTo100","paneProperties.axisProperties.log","paneProperties.axisProperties.alignLabels","paneProperties.axisProperties.isInverted","paneProperties.legendProperties.showStudyArguments","paneProperties.legendProperties.showStudyTitles","paneProperties.legendProperties.showStudyValues","paneProperties.legendProperties.showSeriesTitle","paneProperties.legendProperties.showSeriesOHLC","paneProperties.legendProperties.showLegend","paneProperties.legendProperties.showBarChange","paneProperties.legendProperties.showBackground","paneProperties.legendProperties.backgroundTransparency","scalesProperties.axisHighlightColor","scalesProperties.axisLineToolLabelBackgroundColorActive","scalesProperties.axisLineToolLabelBackgroundColorCommon","scalesProperties.backgroundColor","scalesProperties.lineColor","scalesProperties.textColor","scalesProperties.fontSize","scalesProperties.scaleSeriesOnly","scalesProperties.showSeriesLastValue","scalesProperties.seriesLastValueMode","scalesProperties.showSeriesPrevCloseValue","scalesProperties.showStudyLastValue","scalesProperties.showSymbolLabels","scalesProperties.showStudyPlotLabels","scalesProperties.showPriceScaleCrosshairLabel","scalesProperties.showTimeScaleCrosshairLabel","timeScale.rightOffset","sessions.vertlines.sessBreaks.color","sessions.vertlines.sessBreaks.style","sessions.vertlines.sessBreaks.visible","sessions.vertlines.sessBreaks.width","mainSeriesProperties.style","mainSeriesProperties.visible","mainSeriesProperties.showPriceLine","mainSeriesProperties.priceLineWidth","mainSeriesProperties.priceLineColor","mainSeriesProperties.baseLineColor","mainSeriesProperties.showPrevClosePriceLine","mainSeriesProperties.prevClosePriceLineWidth","mainSeriesProperties.prevClosePriceLineColor","mainSeriesProperties.showCountdown","mainSeriesProperties.priceAxisProperties.autoScale","mainSeriesProperties.priceAxisProperties.lockScale","mainSeriesProperties.priceAxisProperties.percentage","mainSeriesProperties.priceAxisProperties.indexedTo100","mainSeriesProperties.priceAxisProperties.log","mainSeriesProperties.priceAxisProperties.isInverted","mainSeriesProperties.priceAxisProperties.alignLabels","mainSeriesProperties.statusViewStyle.showExchange","mainSeriesProperties.statusViewStyle.showInterval","mainSeriesProperties.statusViewStyle.symbolTextSource","symbolWatermarkProperties.color ","symbolWatermarkProperties.visibility ","mainSeriesProperties.highLowAvgPrice.highLowPriceLinesVisible","mainSeriesProperties.highLowAvgPrice.highLowPriceLabelsVisible","mainSeriesProperties.highLowAvgPrice.averageClosePriceLineVisible","mainSeriesProperties.highLowAvgPrice.averageClosePriceLabelVisible","mainSeriesProperties.candleStyle.upColor","mainSeriesProperties.candleStyle.downColor","mainSeriesProperties.candleStyle.drawWick","mainSeriesProperties.candleStyle.drawBorder","mainSeriesProperties.candleStyle.borderColor","mainSeriesProperties.candleStyle.borderUpColor","mainSeriesProperties.candleStyle.borderDownColor","mainSeriesProperties.candleStyle.wickColor","mainSeriesProperties.candleStyle.wickUpColor","mainSeriesProperties.candleStyle.wickDownColor","mainSeriesProperties.candleStyle.barColorsOnPrevClose","mainSeriesProperties.candleStyle.drawBody","mainSeriesProperties.hollowCandleStyle.upColor","mainSeriesProperties.hollowCandleStyle.downColor","mainSeriesProperties.hollowCandleStyle.drawWick","mainSeriesProperties.hollowCandleStyle.drawBorder","mainSeriesProperties.hollowCandleStyle.borderColor","mainSeriesProperties.hollowCandleStyle.borderUpColor","mainSeriesProperties.hollowCandleStyle.borderDownColor","mainSeriesProperties.hollowCandleStyle.wickColor","mainSeriesProperties.hollowCandleStyle.wickUpColor","mainSeriesProperties.hollowCandleStyle.wickDownColor","mainSeriesProperties.hollowCandleStyle.drawBody","mainSeriesProperties.haStyle.upColor","mainSeriesProperties.haStyle.downColor","mainSeriesProperties.haStyle.drawWick","mainSeriesProperties.haStyle.drawBorder","mainSeriesProperties.haStyle.borderColor","mainSeriesProperties.haStyle.borderUpColor","mainSeriesProperties.haStyle.borderDownColor","mainSeriesProperties.haStyle.wickColor","mainSeriesProperties.haStyle.wickUpColor","mainSeriesProperties.haStyle.wickDownColor","mainSeriesProperties.haStyle.barColorsOnPrevClose","mainSeriesProperties.haStyle.drawBody","mainSeriesProperties.barStyle.upColor","mainSeriesProperties.barStyle.downColor","mainSeriesProperties.barStyle.barColorsOnPrevClose","mainSeriesProperties.barStyle.dontDrawOpen","mainSeriesProperties.barStyle.thinBars","mainSeriesProperties.columnStyle.upColor","mainSeriesProperties.columnStyle.downColor","mainSeriesProperties.columnStyle.barColorsOnPrevClose","mainSeriesProperties.columnStyle.priceSource","mainSeriesProperties.lineStyle.color","mainSeriesProperties.lineStyle.linestyle","mainSeriesProperties.lineStyle.linewidth","mainSeriesProperties.lineStyle.priceSource","mainSeriesProperties.areaStyle.color1","mainSeriesProperties.areaStyle.color2","mainSeriesProperties.areaStyle.linecolor","mainSeriesProperties.areaStyle.linestyle","mainSeriesProperties.areaStyle.linewidth","mainSeriesProperties.areaStyle.priceSource","mainSeriesProperties.areaStyle.transparency","mainSeriesProperties.baselineStyle.baselineColor","mainSeriesProperties.baselineStyle.topFillColor1","mainSeriesProperties.baselineStyle.topFillColor2","mainSeriesProperties.baselineStyle.bottomFillColor1","mainSeriesProperties.baselineStyle.bottomFillColor2","mainSeriesProperties.baselineStyle.topLineColor","mainSeriesProperties.baselineStyle.bottomLineColor","mainSeriesProperties.baselineStyle.topLineWidth","mainSeriesProperties.baselineStyle.bottomLineWidth","mainSeriesProperties.baselineStyle.priceSource","mainSeriesProperties.baselineStyle.transparency","mainSeriesProperties.baselineStyle.baseLevelPercentage","mainSeriesProperties.hiloStyle.color","mainSeriesProperties.hiloStyle.showBorders","mainSeriesProperties.hiloStyle.borderColor","mainSeriesProperties.hiloStyle.showLabels","mainSeriesProperties.hiloStyle.labelColor","mainSeriesProperties.pbStyle.upColor","mainSeriesProperties.pbStyle.downColor","mainSeriesProperties.pbStyle.borderUpColor","mainSeriesProperties.pbStyle.borderDownColor","mainSeriesProperties.pbStyle.upColorProjection","mainSeriesProperties.pbStyle.downColorProjection","mainSeriesProperties.pbStyle.borderUpColorProjection","mainSeriesProperties.pbStyle.borderDownColorProjection","mainSeriesProperties.renkoStyle.upColor","mainSeriesProperties.renkoStyle.downColor","mainSeriesProperties.renkoStyle.borderUpColor","mainSeriesProperties.renkoStyle.borderDownColor","mainSeriesProperties.renkoStyle.upColorProjection","mainSeriesProperties.renkoStyle.downColorProjection","mainSeriesProperties.renkoStyle.borderUpColorProjection","mainSeriesProperties.renkoStyle.borderDownColorProjection","mainSeriesProperties.renkoStyle.wickUpColor","mainSeriesProperties.renkoStyle.wickDownColor","mainSeriesProperties.kagiStyle.upColor","mainSeriesProperties.kagiStyle.downColor","mainSeriesProperties.kagiStyle.upColorProjection","mainSeriesProperties.kagiStyle.downColorProjection","mainSeriesProperties.pnfStyle.upColor","mainSeriesProperties.pnfStyle.downColor","mainSeriesProperties.pnfStyle.upColorProjection","mainSeriesProperties.pnfStyle.downColorProjection","mainSeriesProperties.rangeStyle.upColor","mainSeriesProperties.rangeStyle.downColor","mainSeriesProperties.rangeStyle.thinBars","mainSeriesProperties.rangeStyle.upColorProjection","mainSeriesProperties.rangeStyle.downColorProjection"];var ne=(r,t)=>{const e=u.useRef(!1),s=u.useRef(!1);u.useEffect(()=>{if(e.current&&s.current)return r();s.current=!0},t),u.useEffect(()=>(e.current=!0,()=>{e.current=!1}),[])},[Tr,it]=Dt({name:"ListStylesContext",errorMessage:`useListStyles returned is 'undefined'. Seems you forgot to wrap the components in "<List />" `}),fe=Q(function(t,e){const s=Nt("List",t),{children:i,styleType:n="none",stylePosition:o,spacing:l,...m}=Vt(t),d=_t(i),p=l?{["& > *:not(style) ~ *:not(style)"]:{mt:l}}:{};return A.jsx(Tr,{value:s,children:A.jsx(Ke.ul,{ref:e,listStyleType:n,listStylePosition:o,role:"list",__css:{...s.container,...p},...m,children:d})})});fe.displayName="List";var xr=Q((r,t)=>{const{as:e,...s}=r;return A.jsx(fe,{ref:t,as:"ol",styleType:"decimal",marginStart:"1em",...s})});xr.displayName="OrderedList";var Ar=Q(function(t,e){const{as:s,...i}=t;return A.jsx(fe,{ref:e,as:"ul",styleType:"initial",marginStart:"1em",...i})});Ar.displayName="UnorderedList";var Lr=Q(function(t,e){const s=it();return A.jsx(Ke.li,{ref:e,...t,__css:s.item})});Lr.displayName="ListItem";var Br=Q(function(t,e){const s=it();return A.jsx(Mt,{ref:e,role:"presentation",...t,__css:s.icon})});Br.displayName="ListIcon";function Ur(){var r=u.useRef(!0);return r.current?(r.current=!1,!0):r.current}var Ir=function(r,t){var e=Ur();u.useEffect(function(){if(!e)return r()},t)},js=function(){};function Er(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];r&&r.addEventListener&&r.addEventListener.apply(r,t)}function Rr(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];r&&r.removeEventListener&&r.removeEventListener.apply(r,t)}var he=typeof window<"u";function Dr(r,t){t===void 0&&(t=0);var e=u.useRef(!1),s=u.useRef(),i=u.useRef(r),n=u.useCallback(function(){return e.current},[]),o=u.useCallback(function(){e.current=!1,s.current&&clearTimeout(s.current),s.current=setTimeout(function(){e.current=!0,i.current()},t)},[t]),l=u.useCallback(function(){e.current=null,s.current&&clearTimeout(s.current)},[]);return u.useEffect(function(){i.current=r},[r]),u.useEffect(function(){return o(),l},[t]),[n,l,o]}function Nr(r,t,e){e===void 0&&(e=[]);var s=Dr(r,t),i=s[0],n=s[1],o=s[2];return u.useEffect(o,e),[i,n]}var Vr=function(r){u.useEffect(r,[])},_r=function(r,t){var e=u.useRef(function(){});u.useEffect(function(){e.current=r}),u.useEffect(function(){if(t!==null){var s=setInterval(function(){return e.current()},t||0);return function(){return clearInterval(s)}}},[t])},Mr=function(r){var t=u.useRef(r);t.current=r,Vr(function(){return function(){return t.current()}})},Hr=function(r){var t=u.useRef(0),e=u.useState(r),s=e[0],i=e[1],n=u.useCallback(function(o){cancelAnimationFrame(t.current),t.current=requestAnimationFrame(function(){i(o)})},[]);return Mr(function(){cancelAnimationFrame(t.current)}),[s,n]},Gs=function(r,t){r===void 0&&(r=1/0),t===void 0&&(t=1/0);var e=Hr({width:he?window.innerWidth:r,height:he?window.innerHeight:t}),s=e[0],i=e[1];return u.useEffect(function(){if(he){var n=function(){i({width:window.innerWidth,height:window.innerHeight})};return Er(window,"resize",n),function(){Rr(window,"resize",n)}}},[]),s};const $r=L({timestamp:h(),open:c(),openUsd:c().nullable(),high:c(),highUsd:c().nullable(),low:c(),lowUsd:c().nullable(),close:c(),closeUsd:c().nullable(),volumeUsd:c().nullable()}),Or=a.object({timestamp:a.number(),open:a.string(),openUsd:a.string().nullable(),high:a.string(),highUsd:a.string().nullable(),low:a.string(),lowUsd:a.string().nullable(),close:a.string(),closeUsd:a.string().nullable(),volumeUsd:a.string().nullable(),minBlockNumber:a.number(),maxBlockNumber:a.number()}),Wr=L({timestamp:h(),open:c(),openUsd:c().nullable(),high:c(),highUsd:c().nullable(),low:c(),lowUsd:c().nullable(),close:c(),closeUsd:c().nullable(),volumeUsd:c().nullable(),minBlockNumber:h(),maxBlockNumber:h()});L({schemaVersion:c(),bars:F($r).nullable()});const Fr=a.object({schemaVersion:a.string(),bars:le(Or).nullable()}),jr=L({schemaVersion:c(),bars:F(Wr).nullable()}),Gr=x(Ze(),r=>{const t={schemaVersion:"1.0.0",format:"json",endpoints:{root:`${r.DS_DEX_CHART_UNISWAP_HOST}/dex/chart/uniswap`}},e={schemaVersion:"1.0.0",format:"json",endpoints:{root:`${r.DS_DEX_CHART_BALANCER_HOST}/dex/balancer/chart`}},s={schemaVersion:"1.0.0",format:"json",endpoints:{root:`${r.DS_DEX_CHART_OSMOSIS_HOST}/dex/osmosis/chart`}},i={schemaVersion:"1.0.0",endpoints:{root:`${r.DS_DEX_CHART_AMM_HOST}/dex/chart/amm/v3`}};return{get(n){var m,d;const o=(m=n==null?void 0:n.context)==null?void 0:m.toLowerCase(),l=(d=n==null?void 0:n.ammId)==null?void 0:d.toLowerCase();return o==="u"?t:o==="b"?e:o==="o"?s:{...i,endpoints:{root:`${i.endpoints.root}/${l}`}}}}}),qr=x(Gr,Qe,(r,t)=>{const e=s=>{const i=r.get(s),n=new URL(`${i.endpoints.root}/bars/${s.chainId}/${encodeURIComponent(s.pairAddress)}`);return s.chartType==="marketCap"&&(n.searchParams.set("mc","1"),s.circulatingSupply&&n.searchParams.set("cs",s.circulatingSupply.toString())),s.beforeBlockNumber&&n.searchParams.set("bbn",s.beforeBlockNumber.toString()),s.afterBlockNumber&&n.searchParams.set("abn",s.afterBlockNumber.toString()),n.searchParams.set("res",s.resolution),n.searchParams.set("cb",s.countBack.toString()),n.searchParams.set("q",s.quoteTokenAddress),s.usdOnly||n.searchParams.set("uo","0"),s.isInverted&&n.searchParams.set("i","1"),n};return{getBars:async s=>{const i=e(s);return r.get(s).format==="json"?t.get(i.toString(),Fr):t.avro(i.toString(),jr)}}}),zr=r=>{const[t,e]=u.useState("visible"),[s,i]=u.useState(!0);return u.useEffect(()=>{const n=()=>{document.visibilityState==="hidden"?e("hidden"):document.visibilityState==="visible"&&(e("visible"),i(!0))};return document.addEventListener("visibilitychange",n),()=>document.removeEventListener("visibilitychange",n)},[r==null?void 0:r.hiddenDebounceInMs]),Nr(()=>{t==="hidden"&&i(!1)},r==null?void 0:r.hiddenDebounceInMs,[r==null?void 0:r.hiddenDebounceInMs,t]),s},He={production:{visibleDefault:4500,visibleFast:3e3,invisible:1e4},development:{visibleDefault:3e3,visibleFast:1e3,invisible:5e3}},$e=r=>{const t=r.isDev?He.development:He.production;return r.isPageVisible?r.m5Txns>=20||r.isMoonshot?{type:"visibleFast",rate:t.visibleFast}:{type:"visibleDefault",rate:t.visibleDefault}:{type:"invisible",rate:t.invisible}},Oe=r=>{console.log(new Date,`${r.source}.polling.type=${r.chartAndTxnsPollingRate.type} ${r.source}.polling.rate=${r.chartAndTxnsPollingRate.rate}`)},Xr=r=>{const e=u.useMemo(()=>!!(typeof window<"u"&&window.location.search.includes("debugPolling=1")),[]),s=zr({hiddenDebounceInMs:3e4}),i=Ht(r.pair),[n,o]=u.useState(()=>{const l=$e({isPageVisible:s,m5Txns:r.pair.txns.m5.buys+r.pair.txns.m5.sells,isDev:!1,isMoonshot:i});return e&&Oe({source:r.source,chartAndTxnsPollingRate:l}),l});return Ir(()=>{const l=$e({isPageVisible:s,m5Txns:r.pair.txns.m5.buys+r.pair.txns.m5.sells,isDev:!1,isMoonshot:i});(l.type!==n.type||l.rate!==n.rate)&&(e&&Oe({source:r.source,chartAndTxnsPollingRate:l}),o(l))},[e,n.type,n.rate,s,r.pair.txns.m5.buys,r.pair.txns.m5.sells,!1,i]),{chartAndTxnsPollingRate:n,isPageVisible:s,debugPolling:e}},at=a.object({buys:a.number(),sells:a.number(),volumeUsdBuy:a.number(),volumeUsdSell:a.number(),amountBuy:a.string(),amountSell:a.string(),balanceAmount:a.string().nullable(),balancePercentage:a.number().nullable(),firstSwap:a.number(),new:a.boolean()}),ve=L({buys:h(),sells:h(),volumeUsdBuy:h(),volumeUsdSell:h(),amountBuy:c(),amountSell:c(),balanceAmount:c().nullable(),balancePercentage:h().nullable(),firstSwap:h(),new:$t()}),Jr=a.object({logType:a.literal("swap"),blockNumber:a.number(),blockTimestamp:a.number(),txnHash:a.string(),maker:a.string().optional(),makerScreener:at.optional(),logIndex:a.number(),txnType:a.literal("buy").or(a.literal("sell")),priceUsd:a.string().optional(),priceNative:a.string().optional(),volumeUsd:a.string().optional(),amount0:a.string(),amount1:a.string()}),Yr=Jr.extend({metadata:a.record(a.string(),a.string()).optional()}),lt=L({logType:O("swap"),blockNumber:h(),blockTimestamp:h(),txnHash:c(),maker:c().optional(),makerScreener:ve.optional(),logIndex:h(),txnType:O("buy").or(O("sell")),priceUsd:c().optional(),volumeUsd:c().optional(),amount0:c(),amount1:c()}),Kr=L({logType:O("swap"),blockNumber:h(),blockTimestamp:h(),txnHash:c(),maker:c().optional(),makerScreener:ve.optional(),logIndex:h(),txnType:O("buy").or(O("sell")),priceUsd:c().optional(),priceNative:c().optional(),volumeUsd:c().optional(),amount0:c(),amount1:c()}),Zr=lt.extend({metadata:et(c(),c()).optional()}),Qr=Kr.extend({metadata:et(c(),c()).optional()}),es=a.object({logType:a.literal("add").or(a.literal("remove")),blockNumber:a.number(),blockTimestamp:a.number(),txnHash:a.string(),maker:a.string().optional(),makerScreener:at.optional(),logIndex:a.number(),amount0:a.string(),amount1:a.string()}),Pe=L({logType:O("add").or(O("remove")),blockNumber:h(),blockTimestamp:h(),txnHash:c(),maker:c().optional(),makerScreener:ve.optional(),logIndex:h(),amount0:c(),amount1:c()}),ts=lt.or(Pe),rs=Yr.or(es),ss=Zr.or(Pe),ns=Qr.or(Pe);L({schemaVersion:c(),baseTokenSymbol:c().optional(),quoteTokenSymbol:c().optional(),logs:F(ts).nullable()});L({logs:F(ss).nullable()});const os=a.object({logs:le(rs).nullable()}),is=L({logs:F(ns).nullable()}),as=a.object({firstBlockTimestamp:a.date(),maker:a.string(),buys:a.number(),sells:a.number(),volumeUsdBuy:a.number(),volumeUsdSell:a.number(),amountBuy:a.string(),amountSell:a.string(),pnl:a.number(),balanceAmount:a.string().nullable(),balancePercentage:a.number().nullable()}),ls=L({firstBlockTimestamp:Ot(),maker:c(),buys:h(),sells:h(),volumeUsdBuy:h(),volumeUsdSell:h(),amountBuy:c(),amountSell:c(),pnl:h(),balanceAmount:c().nullable(),balancePercentage:h().nullable()}),cs=le(as),us=F(ls),ds=a.object({maker:a.string(),buys:a.number(),sells:a.number(),volumeUsdBuy:a.number(),volumeUsdSell:a.number(),amountBuy:a.string(),amountSell:a.string(),balanceAmount:a.string().nullable(),balancePercentage:a.number().nullable(),firstSwap:a.number(),lastSwap:a.number()}),ms=L({maker:c(),buys:h(),sells:h(),volumeUsdBuy:h(),volumeUsdSell:h(),amountBuy:c(),amountSell:c(),balanceAmount:c().nullable(),balancePercentage:h().nullable(),firstSwap:h(),lastSwap:h()}),ps=le(ds),Ss=F(ms),hs=x(Ze(),r=>{const t={format:"json",endpoints:{root:`${r.DS_DEX_LOG_UNISWAP_HOST}/dex/log/uniswap`}},e={format:"json",endpoints:{root:`${r.DS_DEX_LOG_BALANCER_HOST}/dex/balancer/log`}},s={format:"json",endpoints:{root:`${r.DS_DEX_LOG_OSMOSIS_HOST}/dex/osmosis/log`}},i={all:{endpoints:{root:`${r.DS_DEX_LOG_AMM_HOST}/dex/log/amm/v4`}},top:{endpoints:{root:`${r.DS_DEX_LOG_AMM_HOST}/dex/log/amm/v4`}},snipers:{endpoints:{root:`${r.DS_DEX_LOG_AMM_HOST}/dex/log/amm/v1`}}};return{get(n,o="all"){return n.c==="u"?{...t,route:"all"}:n.c==="b"?{...e,route:"logs"}:n.c==="o"?{...s,route:"logs"}:{...i[o],route:o,endpoints:{root:`${i[o].endpoints.root}/${n.c==="a"?n.a:""}`}}}}}),gs=x(hs,Qe,(r,t)=>{const e=({pair:n,filters:o,isInverted:l,beforeBlockNumber:m,afterBlockNumber:d})=>{const S=r.get(n,"all"),p=new URL(`${S.endpoints.root}/${S.route}/${n.chainId}/${encodeURIComponent(n.pairAddress)}`);return m&&p.searchParams.set("bbn",m.toString()),d&&p.searchParams.set("abn",d.toString()),n.quoteToken.address&&p.searchParams.set("q",n.quoteToken.address),l&&p.searchParams.set("i","1"),o.type&&p.searchParams.set("ft",o.type),o.amountUsd.min&&p.searchParams.set("vumi",o.amountUsd.min.toString()),o.amountUsd.max&&p.searchParams.set("vuma",o.amountUsd.max.toString()),o.amount0.min&&p.searchParams.set("a0mi",o.amount0.min.toString()),o.amount0.max&&p.searchParams.set("a0ma",o.amount0.max.toString()),o.amount1.min&&p.searchParams.set("a1mi",o.amount1.min.toString()),o.amount1.max&&p.searchParams.set("a1ma",o.amount1.max.toString()),o.timestamp.min&&p.searchParams.set("tss",o.timestamp.min.toString()),o.timestamp.max&&p.searchParams.set("tse",o.timestamp.max.toString()),o.maker&&p.searchParams.set("m",o.maker),p.searchParams.set("c","1"),p},s=({pair:n,sortBy:o,maxDaysAgo:l})=>{const m=r.get(n,"top"),d=new URL(`${m.endpoints.root}/top/${n.chainId}/${encodeURIComponent(n.pairAddress)}`);return n.quoteToken.address&&d.searchParams.set("q",n.quoteToken.address),l&&d.searchParams.set("mda",l.toString()),o&&o.type&&d.searchParams.set("s",o.type),o&&o.direction&&d.searchParams.set("sd",o.direction),d},i=({pair:n})=>{const o=r.get(n,"snipers"),l=new URL(`${o.endpoints.root}/snipers/${n.chainId}/${encodeURIComponent(n.pairAddress)}`);return n.quoteToken.address&&l.searchParams.set("q",n.quoteToken.address),l};return{getServer:n=>r.get(n),getLogs:async n=>{const o=e(n).toString();return r.get(n.pair).format==="json"?t.get(o.toString(),os):t.avro(o.toString(),is)},getTopMakers:async n=>{const o=s(n);return r.get(n.pair).format==="json"?t.get(o.toString(),ps):t.avro(o.toString(),Ss)},getSnipers:async n=>{const o=i(n);return r.get(n.pair).format==="json"?t.get(o.toString(),cs):t.avro(o.toString(),us)}}}),bs=x(gs,ae,(r,t)=>{const e=new Wt(void 0);return{tradingHistoryResponse:e,fetchHistory:async n=>{const o=e.getValue(),l=new Date().getTime();try{const m=await r.getLogs(n),d=m.logs;if(d){if(n.isFetchingPastTradingHistory&&(o!=null&&o.success))e.next({...o,value:{...o.value,tradingHistory:[...o.value.tradingHistory,...d],fetchedAtTimestamp:l}});else{let S=[];!n.isUpdatingFilter&&o&&o.success&&o.value.tradingHistory&&S.push(...o.value.tradingHistory),S=[...d,...S],n.currentListRange&&n.currentListRange.endIndex<50&&(S=S.slice(0,100)),S[0]&&e.next({success:!0,value:{tradingHistory:S,latestBlockNumber:S[0].blockNumber,fetchedAtTimestamp:l,filteredResult:{byMaker:n.filters.maker!==null}}})}return}(!o||!o.success||n.isUpdatingFilter)&&e.next({success:!0,value:{...m,tradingHistory:[],latestBlockNumber:null,fetchedAtTimestamp:l,filteredResult:{byMaker:n.filters.maker!==null}}})}catch(m){t.error({event:{id:"failedFetchingTradingHistory",data:{error:m,chainId:n.pair.chainId,pairId:n.pair.pairAddress,recent:!n.isFetchingPastTradingHistory,beforeBlockNumber:n.beforeBlockNumber,afterBlockNumber:n.afterBlockNumber}}}),o!=null&&o.success&&n.isUpdatingFilter?e.next({success:!0,value:{...o.value,tradingHistory:[],fetchedAtTimestamp:l,filteredResult:{byMaker:n.filters.maker!==null}}}):(!o||!o.success)&&e.next({success:!1,error:"failed"})}},clearHistory:()=>e.next(void 0)}}),ys=r=>"txnType"in r?r.txnType:r.logType,fs=r=>{if("volumeUsd"in r)return r.volumeUsd},vs={buy:"B",sell:"S",add:"A",remove:"R"},We={buy:"Bought",sell:"Sold",add:"Added",remove:"Removed"},Ps=r=>{const t=ys(r.tradingHistory),e=fs(r.tradingHistory);let s="";if(e){const i=Ft({number:e,significantDigits:2,addCommas:!0});s=`${We[t]} $${i} on ${jt(r.tradingHistory.blockTimestamp,"MMM d yy hh:mm a")}`}return(t==="add"||t==="remove")&&(s=`${We[t]} ${r.tradingHistory.amount0} ${r.pairBaseTokenSymbol}`),{id:`${r.tradingHistory.txnHash}:${r.tradingHistory.logIndex}`,text:s,color:t==="remove"||t==="sell"?"#e53e3e":"#38a169",label:vs[t],timestamp:r.tradingHistory.blockTimestamp}},ws=r=>{const t=R(bs),[e,s]=u.useState([]);return tt(()=>t.tradingHistoryResponse.pipe(rt(i=>{if(!i){s([]);return}if(i.success)if(i.value.filteredResult.byMaker){const n=i.value.tradingHistory.map(o=>Ps({tradingHistory:o,pairBaseTokenSymbol:r.pair.baseToken.symbol}));s(n)}else e.length>0&&s([])})),[t.tradingHistoryResponse,r.pair.baseToken.symbol,e.length]),{tradingHistoryMarks:e}},Cs=x(ae,st,(r,t)=>({async persistPairChartSettings(e){var i;const s={type:"savePairChartSettings",input:e};(i=t.ReactNativeWebView)==null||i.postMessage(JSON.stringify(s))},async getPairChartSettings(e){const s=Se.safeParse(t.chartSettingsWebView);if(!s.success){r.error({event:{id:"failedParsingChartSettingsWebView",data:{entityType:"pairChartSettings",error:s.error,pair:e.pair}}});return}return s.data.pairChartSettings},getGlobalChartSettings(){const e=new Gt,s=Se.safeParse(t.chartSettingsWebView);return s.success?e.next(s.data.globalChartSettings):(r.error({event:{id:"failedParsingChartSettingsWebView",data:{entityType:"globalChartSettings",error:s.error}}}),e.next(void 0)),e},async persistGlobalChartSettings(e){var i;const s={type:"saveGlobalChartSettings",input:e};(i=t.ReactNativeWebView)==null||i.postMessage(JSON.stringify(s))},async getStudyTemplates(){const e=Se.safeParse(t.chartSettingsWebView);return e.success?e.data.chartStudyTemplates??[]:(r.error({event:{id:"failedParsingChartSettingsWebView",data:{entityType:"chartStudyTemplates",error:e.error}}}),[])},async persistStudyTemplate(e){var i;const s={type:"saveChartStudyTemplate",input:e};(i=t.ReactNativeWebView)==null||i.postMessage(JSON.stringify(s))},async deleteStudyTemplate(e){var i;const s={type:"deleteChartStudyTemplate",id:e};(i=t.ReactNativeWebView)==null||i.postMessage(JSON.stringify(s))}})),ks=x(Cr,wr,Pr,(r,t,e)=>({async persistPairChartSettings(s){await r.actions.persistPairChartSettings(s)},async getPairChartSettings(s){return r.actions.getPairChartSettings(s)},getGlobalChartSettings(){return t.all},async persistGlobalChartSettings(s){await t.actions.persistGlobalChartSettings(s)},async getStudyTemplates(){return e.actions.allChartStudyTemplates()},async persistStudyTemplate(s){await e.actions.persistChartStudyTemplate(s)},async deleteStudyTemplate(s){await e.actions.deleteChartStudyTemplate(s)}})),we=x(st,ks,Cs,(r,t,e)=>r.chartSettingsWebView?e:t),Ts=a.object({version:a.number(),panes:a.array(a.unknown()),symbol:a.string().optional(),interval:a.string().optional()}),Fe=r=>{const t=Ts.parse(JSON.parse(r));return t.symbol&&delete t.symbol,JSON.stringify(t)},xs=x(we,qt,(r,t)=>({saveLineToolsAndGroups:async()=>{},loadLineToolsAndGroups:async()=>null,getAllCharts:async()=>[],removeChart:async()=>{},saveChart:async()=>"",getChartContent:async()=>"",getChartTemplateContent:async()=>({}),getAllChartTemplates:async()=>[],saveChartTemplate:async()=>{},removeChartTemplate:async()=>{},getDrawingTemplates:async()=>[],loadDrawingTemplate:async()=>"",removeDrawingTemplate:async()=>{},saveDrawingTemplate:async()=>{},getAllStudyTemplates:async()=>{try{return(await r.getStudyTemplates()).map(s=>({name:s.name,content:""}))}catch{return t.track({event:"chart:studyTemplates:error"}),[]}},getStudyTemplateContent:async e=>{t.track({event:"chart:studyTemplates:apply"});try{const s=await r.getStudyTemplates();if(!s)return"";const i=s.find(n=>n.name===e.name);return i?Fe(i.content):""}catch{return t.track({event:"chart:studyTemplates:error"}),""}},saveStudyTemplate:async e=>{t.track({event:"chart:studyTemplates:save"});try{await r.persistStudyTemplate({schemaVersion:"1.0.0",name:e.name,content:Fe(e.content)})}catch{t.track({event:"chart:studyTemplates:error"})}},removeStudyTemplate:async e=>{t.track({event:"chart:studyTemplates:delete"});try{const s=await r.getStudyTemplates();if(!s)return;const i=s.find(n=>n.name===e.name);if(!i)return;await r.deleteStudyTemplate(i.id)}catch{t.track({event:"chart:studyTemplates:error"})}}})),je=[$["1S"],$[1],$[5],$[15],$[60],$[240],$["1D"]],As=r=>r&&r==="a"?je:je.filter(t=>t.indexOf("S")===-1),Ls=r=>r&&r==="a"?be:be.filter(t=>t.indexOf("S")===-1),Bs=r=>be.find(t=>t==r),Us=r=>typeof r=="boolean"||typeof r=="number"||typeof r=="string",ye=(r,t=null,e={})=>{for(const s in r){const i=t?`${t}.${s}`:s,n=r[s];nt(n)?ye(n,i,e):Us(n)&&(e[i]=n)}return e},Is=r=>{let t={};if(!r)return t;const e=r.settings;if(e.chartproperties){const s=JSON.parse(e.chartproperties);nt(s)&&(t=ye(s))}if(e[Me]){const s=ye({mainSeriesProperties:JSON.parse(e[Me])});t={...t,...s}}for(const s of Object.keys(t))kr.includes(s)||delete t[s];return t},Ge=new Ye,Es=r=>{if(r&&r.settings[_e])return Bs(r.settings[_e])},Rs=x(we,r=>async t=>{let e=!1;const s=setTimeout(()=>{e=!0,clearTimeout(s)},2e3);return{subscription:Ge.pipe(Sr(1e3),zt(n=>n.length>0),Xt(n=>n.reduce((o,l)=>({...o,...l}),{}))).subscribe(async n=>{await r.persistGlobalChartSettings({schemaVersion:"1.0.0",settings:n})}),widgetOverrides:Is(t),widgetLastUsedTime:Es(t),settingsAdapter:{initialSettings:t==null?void 0:t.settings,setValue:async(n,o)=>{e&&Ge.next({[n]:o})},removeValue:()=>{}}}}),Ds=x(cr,r=>async t=>{if(t.trim().length<2)return[];const e=Jt(r.searchPairs({query:t}));return await I(e)}),B={default:{color:"var(--tv-color-toolbar-button-text,#d1d4dc)",fontWeight:"400"},active:{color:"var(--tv-color-toolbar-button-text-active,#2962ff)",fontWeight:"600"}},Ns=r=>{var s;const t=`color:${B.active.color};font-weight:${B.active.fontWeight}`,e=(s=r.tvWidgetRef.current)==null?void 0:s.createButton();e&&(r.chartType==="price"?(e.style.color="var(--tv-color-toolbar-button-text,#d1d4dc)",e.style.cursor="pointer",e.addEventListener("click",()=>r.onChartTypeChange("marketCap")),e.setAttribute("title","Switch to market cap chart"),e.innerHTML=`<span style="${t}">Price</span> / MCap`):(e.style.color="var(--tv-color-toolbar-button-text,#d1d4dc)",e.style.cursor="pointer",e.addEventListener("click",()=>r.onChartTypeChange("price")),e.setAttribute("title","Switch to price chart"),e.innerHTML=`Price / <span style="${t}">MCap</span>`))},Vs=r=>{var s;if(!r.pair.priceUsd)return;const t=`color:${B.active.color};font-weight:${B.active.fontWeight}`,e=(s=r.tvWidgetRef.current)==null?void 0:s.createButton();if(e){e.style.color=B.default.color,e.style.fontWeight=B.default.fontWeight,e.style.cursor="pointer";const i=Z(r.isInverted?r.pair.baseToken.symbol:r.pair.quoteTokenSymbol,24);r.quotePricingMode==="usd"?(e.innerHTML=`<span style="${t}">USD</span> / ${i}`,e.addEventListener("click",()=>r.onQuotePricingModeChange("quote")),e.setAttribute("title",`Switch to price in ${i}`)):(e.innerHTML=`USD / <span style="${t}">${i}</span>`,e.addEventListener("click",()=>r.onQuotePricingModeChange("usd")),e.setAttribute("title","Switch to price in USD"))}},_s='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="100%" height="100%"><path fill="currentColor" d="M8.5 6A2.5 2.5 0 0 0 6 8.5V11h1V8.5C7 7.67 7.67 7 8.5 7H11V6H8.5zM6 17v2.5A2.5 2.5 0 0 0 8.5 22H11v-1H8.5A1.5 1.5 0 0 1 7 19.5V17H6zM19.5 7H17V6h2.5A2.5 2.5 0 0 1 22 8.5V11h-1V8.5c0-.83-.67-1.5-1.5-1.5zM22 19.5V17h-1v2.5c0 .83-.67 1.5-1.5 1.5H17v1h2.5a2.5 2.5 0 0 0 2.5-2.5z"></path></svg>',Ms=r=>{var e;if(!r.isLargeScreen)return;const t=(e=r.tvWidgetRef.current)==null?void 0:e.createButton();if(t)return t.style.color=B.default.color,t.style.fontWeight=B.default.fontWeight,t.style.cursor="pointer",t.innerHTML=`<span style="display:block;width:24px;height:24px;margin-right:2px;">${_s}</span><span>Full</span>`,t.style.display="flex",t.style.alignItems="center",t.style.padding="0 6px 0 2px",t.addEventListener("click",r.onToggleExpandCollapse),t},qe="tv-chart-container",qs=({chainId:r,dexId:t,pair:e,isInverted:s,circulatingSupply:i,isExpanded:n,quotePricingMode:o,chartType:l,onToggleExpandCollapse:m,onQuotePricingModeChange:d,onChartTypeChange:S,onLatestPrice:p,containerId:f,containerProps:P,widgetConfigOverrides:b,chartStyle:g,intervalOverride:v})=>{const k=Yt({base:!1,lg:!0})??!1,_=Kt(),D=R(lr),E=vr("/tv/v27.001/charting_library.js"),X=u.useRef(null),w=u.useRef(),M=u.useRef(),H=u.useRef(),ee=u.useRef(),W=R(ae),ct=R(ie),j=Zt(ct.currentUser,void 0),Ce=R(ir),[te,J]=u.useState(),[ce,ue]=u.useState(),Y=R(we),ke=R(Rs),de=ws({pair:e}),T=Qt(y=>y.embedSettings),re=u.useMemo(()=>D({dsDataParams:ar({pair:e}),cmsParams:e.cmsProfile?{assetId:e.cmsProfile.iconId,fit:"crop"}:void 0}),[D,e]),K=u.useMemo(()=>({userId:j==null?void 0:j.id,pairId:e.pairAddress,quotePricingMode:o,chainId:r,embedSettings:T}),[r,j==null?void 0:j.id,T,e.pairAddress,o]),G=!T.isEmbed||T.chartSaveDrawings;tt(()=>G?er([T.isEmbed&&!T.loadChartSettings?oe(null):Y.getGlobalChartSettings(),T.isEmbed&&!T.loadChartSettings?oe(null):Y.getPairChartSettings({isInverted:s,quotePricingMode:o,pair:{chainId:r,pairId:e.pairAddress,quoteTokenAddress:e.quoteToken.address,baseTokenAddress:e.baseToken.address}})]).pipe(mr({first:1e4}),ur(()=>(_({status:"error",description:"Failed loading chart settings."}),W.error({event:{id:"failedLoadingChartSettings",data:K}}),J(null),ue(null),tr)),rt(([y,C])=>{if(ue(y??null),!C)return J(null);const N=Ce.getChartContent({chartType:l,pairChartSettings:C,isInverted:s,quotePricingMode:o,pair:{chainId:r,pairId:e.pairAddress,quoteTokenAddress:e.quoteToken.address,baseTokenAddress:e.baseToken.address}});if(N)return J(N);J(null)})):(J(null),ue(null),oe(void 0)),[l,r,Y,s,G,e.baseToken.address,e.pairAddress,e.quoteToken.address,o,Ce,_,K,W,T.isEmbed,T.loadChartSettings]);const Te=R(xs),xe=rr(t),Ae=R(Ds),Le=R(qr),q=ce===void 0||te===void 0||l==="marketCap"&&i===void 0,me=E==="ready",ut=E==="error",dt=()=>{var y,C;(y=H.current)==null||y.setTradingHistoryMarks([]),(C=w.current)==null||C.activeChart().clearMarks()},Be=me&&!q&&w.current!==void 0&&H.current!==void 0;ne(()=>{var y,C;try{if(!Be)return;if(de.tradingHistoryMarks.length===0)return dt();(y=H.current)==null||y.setTradingHistoryMarks(de.tradingHistoryMarks),(C=w.current)==null||C.activeChart().refreshMarks()}catch(N){W.debug({event:{id:"failedLoadingMarks",data:{error:N}}})}},[q,W,de.tradingHistoryMarks,Be]);const Ue=u.useCallback(()=>{const y=a.string().safeParse(r);if(!y.success)return;const C=o==="usd"&&e.priceUsd?e.priceUsd:e.price,N=o==="usd",pt=e.c==="a"?e.a:void 0;return new yr({chartType:l,context:e.c,ammId:pt,chainId:y.data,dexName:xe,pairAddress:e.pairAddress,quoteTokenAddress:e.quoteToken.address,latestPrice:C,useUsdPrice:N,supportedResolutions:Ls(e.c),isInverted:s,searchPair:Ae,onLatestPrice:p,dexChartAmmService:Le,circulatingSupply:i,symbolLogo:re})},[i,l,r,xe,s,p,e,o,Ae,Le,re]),Ie=u.useCallback(async y=>{M.current=await ke(ce);const C=v??M.current.widgetLastUsedTime;return new window.TradingView.widget(hr({chartStyle:g,defaultInterval:C,settingsAdapter:M.current.settingsAdapter,saveLoadAdapter:Te,containerId:f??qe,hideTradingViewLogo:T.dsApp||!T.isEmbed,dataFeed:y.dataFeed,savedData:G?te??void 0:void 0,favoriteIntervals:As(e.c),widgetOverrides:M.current.widgetOverrides,symbolLogo:re,symbol:s?`${Z(e.quoteTokenSymbol,48)}/${Z(e.baseToken.symbol,48)}`:`${Z(e.baseToken.symbol,48)}/${Z(e.quoteTokenSymbol,48)}`,...b}))},[ke,ce,v,g,Te,f,T.dsApp,T.isEmbed,G,te,e.c,e.baseToken.symbol,e.quoteTokenSymbol,re,s,b]),Ee=u.useCallback(async y=>{await Y.persistPairChartSettings({schemaVersion:"1.0.0",isInverted:s,quotePricingMode:o,chartType:l,pair:{chainId:r,pairId:e.pairAddress,quoteTokenAddress:e.quoteToken.address,baseTokenAddress:e.baseToken.address},chartData:JSON.stringify(y)})},[r,Y,s,e,o,l]),Re=E!=="ready"||X.current===void 0||w.current!==void 0;u.useEffect(()=>{q||Re||(H.current=Ue(),H.current&&Ie({dataFeed:H.current}).then(y=>{w.current=y,w.current.headerReady().then(()=>{e.c==="a"&&Ns({chartType:l,tvWidgetRef:w,onChartTypeChange:S}),Vs({isInverted:s,quotePricingMode:o,pair:e,tvWidgetRef:w,onQuotePricingModeChange:d});const C=Ms({isLargeScreen:k,tvWidgetRef:w,onToggleExpandCollapse:m});ee.current=C}).catch(C=>{W.error({event:{id:"failedCreatingTradingViewCustomButtons",data:{...K,error:C}}})}),w.current.onChartReady(()=>{var C;G&&((C=w.current)==null||C.subscribe("onAutoSaveNeeded",()=>{var N;(N=w.current)==null||N.save(Ee)}))})}).catch(y=>{W.error({event:{id:"failedInstantiatingTradingView",data:{...K,error:y}}})}))},[i,E,te,q,Re,Ue,Ie,W,K,s,e,o,d,l,S,k,m,G,Ee]);const{chartAndTxnsPollingRate:se,debugPolling:mt}=Xr({source:"chart",pair:e}),De=()=>{H.current&&H.current.triggerSubscribers()};return _r(()=>De(),se.rate),ne(()=>{se.type!=="invisible"&&(mt&&console.log(new Date,`chart.polling.type=${se.type} trigger chart subscribers`),De())},[se.type]),ne(()=>{v&&w.current&&w.current.activeChart()&&w.current.setSymbol(w.current.activeChart().symbol(),v,()=>{})},[v]),ne(()=>{ee.current&&(ee.current.style.color=n?B.active.color:B.default.color,ee.current.style.fontWeight=n?B.active.fontWeight:B.default.fontWeight)},[n]),u.useEffect(()=>()=>{var y;(y=M.current)==null||y.subscription.unsubscribe()},[M]),A.jsxs(A.Fragment,{children:[ut&&A.jsx(Ve,{flex:1,m:2,...P,children:A.jsx(sr,{size:"sm",title:"Error loading chart",children:"Please refresh this page to try again!"})}),(!me||q)&&A.jsx(Ve,{flex:1,m:2,...P,children:A.jsx(nr,{size:"sm",color:"trading-view.text-color",label:"Loading chart settings..."})}),me&&!q&&A.jsx(or,{ref:X,id:f??qe,flex:1,...P})]})};export{qs as A,fe as L,Lr as a,Gs as b,Ir as c,Rr as d,Br as e,Dr as f,ne as g,Xr as h,he as i,_r as j,bs as k,gs as l,js as n,Er as o,mr as t,vr as u};
